{
  "query": "WITH most_recent_strict_commits AS (\n    SELECT\n        push.head_commit.id as sha,\n    FROM\n        commons.push\n    WHERE\n        push.ref = 'refs/heads/viable/strict'\n        AND push.repository.full_name = 'pytorch/pytorch'\n    ORDER BY\n        push._event_time DESC\n    LIMIT\n        3\n), workflow AS (\n    SELECT\n        id\n    FROM\n        commons.workflow_run w\n        INNER JOIN most_recent_strict_commits c on w.head_sha = c.sha\n),\njob AS (\n    SELECT\n        j.name,\n        j.id,\n  \t\tj.run_id\n    FROM\n        commons.workflow_job j\n        INNER JOIN workflow w on w.id = j.run_id\n),\nclass_duration_per_job AS (\n    SELECT\n        test_run.invoking_file as file,\n        test_run.classname as classname,\n        SUM(time) as time,\n        REGEXP_EXTRACT(job.name, '^(.*) /', 1) as base_name,\n        REGEXP_EXTRACT(job.name, '/ test \\(([\\w-]*),', 1) as test_config,\n    FROM\n        commons.test_run_summary test_run\n        /* `test_run` is ginormous and `job` is small, so lookup join is essential */\n        INNER JOIN job ON test_run.job_id = job.id HINT(join_strategy = lookup)\n    WHERE\n        /* cpp tests do not populate `file` for some reason. */\n        /* Exclude them as we don't include them in our slow test infra */\n        test_run.file IS NOT NULL\n    GROUP BY\n        test_run.invoking_file,\n        test_run.classname,\n        base_name,\n  \t\ttest_config,\n  \t\tjob.run_id\n)\nSELECT\n    REPLACE(file, '.', '/') AS file,\n    classname,\n    base_name,\n    test_config,\n    AVG(time) as time\nFROM\n    class_duration_per_job\nGROUP BY\n    file,\n    classname,\n    base_name,\n    test_config\nORDER BY\n    base_name,\n    test_config,\n    file,\n    classname\n",
  "default_parameters": []
}